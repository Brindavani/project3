<!DOCTYPE html>
<html>
  <head>
  <link rel='shortcut icon' href='Images/nature.ico' type='image/x-icon'/ >
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="https://d3js.org/d3.v3.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="https://d3js.org/topojson.v1.min.js"></script>
<!--	<script src="http://d3js.org/d3.v2.js"></script> -->
    <script src="d3.geo.projection.min.js"></script>
	<style>
	.svg2 {
	margin-left:50px;
	margin-top:50px;
//	cursor: url('Images/nature.ico'), auto;
	}
	
	div.tooltip2 {
    position: absolute;     
    text-align: center;      
    font: 12px segoe ui;    
	background:#444;
    border: 1px solid #444;
	box-shadow: 0 0 5px #444;    
    pointer-events: none;     
	font-weight:bold;
	color:#eee;
	z-index:10;
}
	
	.picture {
	border:1px solid #aaa;
	}
	
	.stacks {
	
	}
	
	#image {
	position:absolute;
	}
	
	.svg3 {
		position:absolute;
		top:58px;
		left:670px;
		margin: 0 auto;
		display: inherit;
//		border:1px solid #000;
	}

.graticule {
  fill: none;
  stroke: #777;
  stroke-width: 2px;
  stroke-opacity: .0;
}

.land {
  fill: #999;
}

.boundary {
  fill: none;
  stroke: #fff;
  stroke-width: .5px;
}

	.node circle {
	  stroke: #fff;
	  stroke-width: 1.5px;
	}
	
	.link {
    stroke: #ccc;
	stroke-width: 1.5px;
    }
	 
	.node text {
    pointer-events: none;
    font: 10px sans-serif;
	}

	.states path {
		stroke-width: 1px;
		stroke: white;
		fill: #DBDBDB;
		cursor: pointer;
	}

	.arcs path {
	  stroke-width: 2px;
	  stroke: tomato;
	  pointer-events: none;
	  fill: none;
	}
	
	.stackdesc, .mapdesc {
	position:absolute;
	top:400px;
	width:600px;
	height:200px;
	border:1px solid #000;
	}
	
	.stackdesc {
	left:50px;
	z-index:5;
	}
	
	.mapdesc {
	left:670px;
	}
	
	.mtitledesc, .mdescdesc {
	border:1px solid red;
	width:500px;
	
	}
	
	.mtitledesc {
	height:50px;
	
	}
	
	.mdescdesc {
	height:100px;
	}
	
	.consspan, .prodspan {
	border:1px solid #000;
	height:40px;
	padding:5px 5px 5px 5px;
	font-size:16px;
	letter-spacing:1px;
	font-family:segoe ui;
	}
	
	.consspan {
	background:#1FDA9A;
	}
	
	.prodspan {
	background:#F2E394;
	}
	
	.titledesc {
	padding-top:10px;
	padding-left:10px;
	border:1px solid #000;
	height:30px;
	}
	
	.imgdesc {
	border:1px solid #F2E394;
	width:120px;
	float:left;
	}
	
	.otherdesc {
	border:1px solid green;
	width:470px;
	float:right;
	height:150px;
	}
	
	.descdesc {
	border:1px solid pink;
	height:50px;
	width:450px;
	}
	
	.linkdesc {
	width:150px;
	height:50px;
	width:450px;
	padding:10px;
	border:1px solid blue;
	}
	
	.anchor {
	border:1px solid tomato;
	position:relative;
	left:170px;
	top:10px;
	}
	
	
	#pieChart {    
	position:absolute;
	top:700px;
	left:100px;
	width:400px;
	height: 400px; 
}



#lineChart {    
	position:absolute;
	top:10px;
	left:410px;
	height: 150px;
}

#barChart {
	position:absolute;
	top:800px;
	left:610px;
	height: 250px;
}

div.tooltip {	
    position: absolute;			
    text-align: center;			
    width: 60px;					
    height: 28px;					
    padding: 2px;				
    font: 12px sans-serif;		
    background: lightsteelblue;	
    border: 0px;		
    border-radius: 8px;			
    pointer-events: none;			
}


.slice {
   font-size: 12pt;
   font-family: Verdana;
   fill: white; //svg specific - instead of color
   font-weight: bold;	
  		} 
		
/*for line chart*/
.axis path, .axis line {
    fill: none;
    stroke: black;
    shape-rendering: crispEdges; //The shape-rendering property is an SVG attribute, used here to make sure our axis and its tick mark lines are pixel-perfect. 
}

.line {
  fill: none;
  /*stroke: steelblue;*/
  stroke-width: 3px;
}

.dot {
  /*fill: white;*/
  /*stroke: steelblue;*/
  stroke-width: 1.5px;
  }
				

.axis text {
    font-family: Verdana;
    font-size: 11px;
}

.title {
	 font-family: Verdana;
    font-size: 15px;	
		
}

.xAxis {
    font-family: verdana;
    font-size: 11px;
    fill: black;
}  

.yAxis {
    font-family: verdana;
    font-size: 11px;
    fill: white;
}

  
table {
	border-collapse:collapse;
	border: 0px;	
	font-family: Verdana;	
	color: #5C5558;
	font-size: 12px;
	text-align: right;			
}

td {
	padding-left: 10px;		
}
	
	</style>
  </head>
  <body>
<!--  <img id="image" src="Images/nature.ico"/> -->
  <script>
 /* 
  $(document).mousemove(function(e){
    $("#image").css({left:e.pageX+20, top:e.pageY+20});
});
  */
  var width2=600;
  var height2=340;
  var width3=600;
  var height3=340;
  var color3=d3.scale.ordinal().range(["#b2977b", "#6cb15e", "#b15e5e","#f4f12e", "#e8a2a2", "#b98de5", "#82dfb8", "#dfb182",  "#56AE7C",  "#64B98C", "#72C39B", "#80CEAA", "#80CCB3", "#7FC9BD", "#7FC7C6", "#7EC4CF", "#7FBBCF", "#7FB1CF", "#80A8CE", "#809ECE", "#8897CE", "#8F90CD", "#9788CD", "#9E81CC", "#AA81C5", "#B681BE", "#C280B7", "#CE80B0", "#D3779F", "#D76D8F", "#DC647E", "#E05A6D", "#E16167", "#E26962", "#E2705C", "#E37756", "#E38457", "#E39158", "#E29D58", "#E2AA59", "#E0B15B", "#DFB95C", "#DDC05E", "#DBC75F", "#E3CF6D", "#EAD67C", "#F2DE8A"]);
  var color2=["#DCDCDC","#D3D3D3","#C0C0C0","#A9A9A9","#808080","#2F4F4F"];
  var stackheight=height2/6;
  var svg2=d3.select("body").append("svg").attr("class","svg2").attr("width",width2).attr("height",height2);
  var svg3=d3.select("body").append("svg").attr("class","svg3").attr("width",width3).attr("height",height3);
  var projection = d3.geo.patterson().scale(100).translate([width3 / 2, height3 / 2]).precision(.1);
  var path = d3.geo.path().projection(projection);
  var graticule = d3.geo.graticule();
  var arcs = svg3.append("g").attr("class","arcs");
  var div2 = d3.select("body").append("div").attr("class", "tooltip2").style("opacity", 0);
  var jsondata;
  var foodchain=[];
  var childarr=[];
  var allstatus=0;
  var presentstatus=0;
  var previousid;
  var previouslvl;
  var centered;

  var gradient2=d3.select(".svg2")
.append("defs")
.append("linearGradient")
    .attr("id", "gradient2")
    .attr("x1", "0%")
    .attr("y1", "0%")
    .attr("x2", "100%")
    .attr("y2", "100%")
    .attr("spreadMethod", "pad");	  

	
gradient2.append("stop")
    .attr("offset", "0%")
    .attr("stop-color", "#1FDA9A")
    .attr("stop-opacity", 1);	
	
gradient2.append("stop")
    .attr("offset", "50%")
    .attr("stop-color", "#F2E394")
    .attr("stop-opacity", 1);
  
  svg3.append("path")
    .datum(graticule)
    .attr("class", "graticule")
    .attr("d", path);
	
	d3.json("World_Map.json", function(error, world) {
  if (error) throw error; 
    var arcdata = [       
        {
			sourceLocation: [10.4515, 51.1657],
			targetLocation: [105.3188, 61.5240]
		}
	]

	
	 var places = [
  {
    name: "Germany",
    location: {
      latitude: 51.1657
,
      longitude: 10.4515

    }
  }]
       
     
  svg3.insert("path", ".graticule")
      .datum(topojson.feature(world, world.objects.land))
      .attr("class", "land")
      .attr("d", path);

  svg3.insert("path", ".graticule")
      .datum(topojson.mesh(world, world.objects.countries, function(a, b) { return a !== b; }))
      .attr("class", "boundary")
      .attr("d", path);
    
           
       
});
	
	d3.select(self.frameElement).style("height", height3 + "px");
	
	
	
	
	
	
	

  svg2.append("rect")
	.attr("width",width2)
	.attr("id","life")
	.attr("height",stackheight)
	.attr("y",0)
	.style("fill",function() {
	return color2[0];
	})
	.attr("stroke-width",1)
	.attr("stroke","#777")
	.on("mouseover",function(){
	/*tooltip here - use jsondata */
	})
	.on("click", function(){
	
	if(previousid!=null) {
	svg2.select(previousid)
	.style("fill", function() {
	return color2[previouslvl+1];
	});
	}
	var nodeid="#life";
	 previousid=nodeid;
	 previouslvl=-1;
	
	svg2.select(nodeid)
	.style("fill", "#A7DBDB");
	
	svg2.selectAll(".leafnodes")
	.style("fill","#2F4F4F");
	svg2.selectAll(".foodpaths").remove();
	svg2.select(".triangles").remove();
//	if(allstatus==0) {
	 // remove all paths
	for(var nodnam in foodchain) { // make all rects to default color
	foodchain[nodnam].status=0;
	var nodname=nodnam.replace(/ /g,'');
	var allid="#"+nodname;
	svg2.select(allid)
	.style("fill","#2F4F4F");
	}
//	allstatus=1;
//	}
//	else if(allstatus==1) {
	for(var node in foodchain){
	if(foodchain[node].eats.length!=0) {	
	var startxpos=foodchain[node].xpos+(foodchain[node].width/2);
	var startypos=foodchain[node].ypos;
	var startpair=startxpos+","+startypos;
	for(var j=0;j<foodchain[node].eats.length;j++){
	var endnode=foodchain[node].eats[j];
	var endxpos=foodchain[endnode].xpos+(foodchain[endnode].width/2);
	var endypos=foodchain[endnode].ypos;
	var endpair=endxpos+","+endypos;
	var xcor=(startxpos+endxpos)/2;
	var dist=Math.sqrt(Math.pow(startxpos-endxpos,2)+Math.pow(startypos-endypos,2));
	var ycor=(2*height2/3)-((height2)*(dist/width2));
	var pathid=node.replace(/ /g,'')+""+foodchain[node].eats[j].replace(/ /g,'');
	var pathstr="M "+startpair+" C"+xcor+","+ycor+" "+xcor+","+ycor+" "+endpair;
	svg2.append("path")
	.attr("id",pathid)
	.attr("class","foodpaths")
//	.transition()
//    .duration(2000)
//   .ease("linear")
	.attr("d", pathstr)
	.attr("fill","none")
	.attr("stroke","#5A6A62")
	.attr("stroke-width",1);
	
	
	var pathidanim="#"+pathid;
	var totalLength = d3.select(pathidanim).node().getTotalLength();
	d3.select(pathidanim)
      .attr("stroke-dasharray", totalLength + " " + totalLength)
      .attr("stroke-dashoffset", totalLength)
      .transition()
        .duration(1000)
        .ease("linear")
        .attr("stroke-dashoffset", 0);
	
	
	}
	foodchain[node].status=1;
	}
	}
	allstatus=0;
//	}
	})
	.on("dblclick", function() {
	svg2.select("#life")
	.style("fill", color2[0]);
	d3.selectAll(".mapdesc").remove();
	d3.selectAll(".consspan").remove();
	d3.selectAll(".prodspan").remove();
	d3.selectAll(".titledesc").remove();
	d3.selectAll(".imgdesc").remove();
	d3.selectAll(".otherdesc").remove();
	svg2.selectAll(".foodpaths").remove();
	svg2.selectAll(".triangles").remove();
	
	for(var noden in foodchain)
	foodchain[noden].status=0;
	
	});
	
	
 function createrect(widthc,levelc,positionc,ifchildc,nodenamec) {
 var nodeid=nodenamec.replace(/ /g,'');
 svg2.append("rect")
	.attr("class","stacks")
	.attr("class", function() {
	if(ifchildc==false)
	return "leafnodes";
	else if(ifchildc==true)
	return "parentnodes";
	})
	.attr("id",nodeid)
	.attr("width",widthc)
	.attr("height",stackheight)
	.attr("x",positionc)
	.attr("y",stackheight*(levelc+1))
	.style("fill",function() {
	if(ifchildc==true)
	return color2[levelc+1];
	else
	return "#2F4F4F";
	})
	.attr("stroke-width",1)
	.attr("stroke","#777")
	.on("click", function() {
	if(ifchildc==false) {
	if(foodchain[nodenamec].status==0) {
	if(foodchain[nodenamec].eats.length!=0) {
	var startxpos=foodchain[nodenamec].xpos+(foodchain[nodenamec].width/2);
	var startypos=foodchain[nodenamec].ypos;
	var startpair=startxpos+","+startypos;
	for(var i=0;i<foodchain[nodenamec].eats.length;i++) {
	var endnode=foodchain[nodenamec].eats[i];
	var endxpos=foodchain[endnode].xpos+(foodchain[endnode].width/2);
	var endypos=foodchain[endnode].ypos;
	var endpair=endxpos+","+endypos;
	var xcor=(startxpos+endxpos)/2;
	var dist=Math.sqrt(Math.pow(startxpos-endxpos,2)+Math.pow(startypos-endypos,2));
	var ycor=(2*height2/3)-((height2)*(dist/width2));
	var pathid=nodenamec.replace(/ /g,'')+""+foodchain[nodenamec].eats[i].replace(/ /g,'');
	var pathstr="M "+startpair+" C"+xcor+","+ycor+" "+xcor+","+ycor+" "+endpair;
	svg2.append("path")
	.attr("id",pathid)
	.attr("class","foodpaths")
	.attr("d", pathstr)
	.attr("fill","none")
	.attr("stroke","#5A6A62")
	.attr("stroke-width",1);
	
	var pathidanim="#"+pathid;
	var totalLength = d3.select(pathidanim).node().getTotalLength();
	d3.select(pathidanim)
      .attr("stroke-dasharray", totalLength + " " + totalLength)
      .attr("stroke-dashoffset", totalLength)
      .transition()
        .duration(1000)
        .ease("linear")
        .attr("stroke-dashoffset", 0);
	
	
	}
	foodchain[nodenamec].status=1;
	}
	}
	else if(foodchain[nodenamec].status==1){ // animate highlighted paths in this block and remove in another block, //on dblclick of rect add locations
	var sourceid="#"+nodenamec.replace(/ /g,'');
	for(var i=0;i<foodchain[nodenamec].eats.length;i++) {
	var pathid="#"+nodenamec.replace(/ /g,'')+""+foodchain[nodenamec].eats[i].replace(/ /g,'');
	var targetid="#"+foodchain[nodenamec].eats[i].replace(/ /g,'');
	
	svg2.select(pathid)
	.attr("stroke-width","3")
	.attr("stroke","url(#gradient2)");
	
	svg2.select(targetid)
	.style("fill","#F2E394");

	//animate here

 	
	svg2.append("path")
	.attr("class","triangles")
	.attr("id",function() {
	return "anims"+nodenamec.replace(/ /g,'')+""+foodchain[nodenamec].eats[i].replace(/ /g,'');
	})
	.attr("d","M-5,-2.5 L5,-2.5 L 0,-17.5 z")
	.attr("stroke","#fff")
	.attr("stroke-width","1")
	.style("fill","#2F4F4F");
	var animsid="#anims"+nodenamec.replace(/ /g,'')+""+foodchain[nodenamec].eats[i].replace(/ /g,'');
	svg2.select(animsid)
	.append("animateMotion")
	.attr("id",function(){
	return "animationin"+nodenamec.replace(/ /g,'')+""+foodchain[nodenamec].eats[i].replace(/ /g,'');
	})
	.attr("dur","6s")
	.attr("repeatCount","indefinite")
	.attr("rotate","auto");
	
	var animationinid="#animationin"+nodenamec.replace(/ /g,'')+""+foodchain[nodenamec].eats[i].replace(/ /g,'');
	
	svg2.select(animationinid)
	.append("mpath")
	.attr("id", function() {
	return "tri"+nodenamec.replace(/ /g,'')+""+foodchain[nodenamec].eats[i].replace(/ /g,'');
	})
	.attr("xlink:href",pathid);
	
	//animation ends here
	
	}
	svg2.select(sourceid)
	.style("fill","#1FDA9A");
	foodchain[nodenamec].status=2;
	
	
	//call map paths here ---------------------------------------------------------------------------------<
	
	
	
	console.log(foodchain[nodenamec]);
	
	
	
	//end map pth calls here ------------------------------------------------------------------------------<
	}
	else if(foodchain[nodenamec].status==2){ // remove animations here in this block, 
	
	var sourceid="#"+nodenamec.replace(/ /g,'');
	for(var i=0;i<foodchain[nodenamec].eats.length;i++) {
	var pathid="#"+nodenamec.replace(/ /g,'')+""+foodchain[nodenamec].eats[i].replace(/ /g,'');
	var targetid="#"+foodchain[nodenamec].eats[i].replace(/ /g,'');
	svg2.select(pathid)
	.attr("stroke","#5A6A62")
	.attr("stroke-width",1);
	svg2.select(targetid)
	.style("fill","#2F4F4F");
	var animsid="#anims"+nodenamec.replace(/ /g,'')+""+foodchain[nodenamec].eats[i].replace(/ /g,'');
	svg2.select(animsid).remove();
	}
	
	svg2.select(sourceid)
	.style("fill","#2F4F4F");
	
	
	
	foodchain[nodenamec].status=1;
	
	}
	}
	else if(ifchildc==true) {
	if(previousid!=null) {
	svg2.select(previousid)
	.style("fill", function() {
	return color2[previouslvl+1];
	});
	}
	var nodeid="#"+nodenamec.replace(/ /g,'');
	 previousid=nodeid;
	 previouslvl=levelc;
	
	svg2.select(nodeid)
	.style("fill", "#A7DBDB");
	svg2.selectAll(".foodpaths").remove();
	svg2.selectAll(".triangles").remove();
	svg2.selectAll(".leafnodes")
	.style("fill","#2F4F4F");
	for(var a=0;a<childarr[nodenamec].length;a++) {		
	var node=childarr[nodenamec][a];	
	var startxpos=foodchain[node].xpos+(foodchain[node].width/2);
	var startypos=foodchain[node].ypos;
	var startpair=startxpos+","+startypos;
	
	if(foodchain[node].eats.length!=0) {
	for(var j=0;j<foodchain[node].eats.length;j++){
	var endnode=foodchain[node].eats[j];
	var endxpos=foodchain[endnode].xpos+(foodchain[endnode].width/2);
	var endypos=foodchain[endnode].ypos;
	var endpair=endxpos+","+endypos;
	var xcor=(startxpos+endxpos)/2;
	var dist=Math.sqrt(Math.pow(startxpos-endxpos,2)+Math.pow(startypos-endypos,2));
	var ycor=(2*height2/3)-((height2)*(dist/width2));
	var pathid=node.replace(/ /g,'')+""+foodchain[node].eats[j].replace(/ /g,'');
	var pathstr="M "+startpair+" C"+xcor+","+ycor+" "+xcor+","+ycor+" "+endpair;
	svg2.append("path")
	.attr("id",pathid)
	.attr("class","foodpaths")
	.attr("d", pathstr)
	.attr("fill","none")
	.attr("stroke","#5A6A62")
	.attr("stroke-width",1);
	
	
	var pathidanim="#"+pathid;
	var totalLength = d3.select(pathidanim).node().getTotalLength();
	d3.select(pathidanim)
      .attr("stroke-dasharray", totalLength + " " + totalLength)
      .attr("stroke-dashoffset", totalLength)
      .transition()
        .duration(1000)
        .ease("linear")
        .attr("stroke-dashoffset", 0);
	
	
	}
	foodchain[node].status=1;
	}
	}
	
	}
	
	
	
	svg3.selectAll(".maplocs").remove();
	svg3.selectAll(".mappaths").remove();
	svg3.selectAll(".mapimages").remove();
	
	//map animations goes here _____________________________________________________________________________________________<
	
	if(foodchain[nodenamec].migrating==false) {
	if(foodchain[nodenamec].locations.length!=0){
	for(var b=0;b<foodchain[nodenamec].locations.length;b++){
	var locationid=(foodchain[nodenamec].locations[b].replace(/ /g,''))+""+(nodenamec.replace(/ /g,''));
	svg3.append("circle")
	.attr("class","maplocs")
	.attr("id",locationid)
	.attr("r", 4)
    .attr("fill", function() {
	return color3(foodchain[nodenamec].locations[b]);
	}) 
    .attr("stroke","#2F4F4F")
	.attr("transform", function() {
    return "translate(" + projection([foodchain[nodenamec].longitude[b], foodchain[nodenamec].latitude[b]]) + ")";
     });
	
	// access data as foodchain[nodenamec].locations[b], foodchain[nodenamec].latitude[b], foodchain[nodenamec].longiude[b]
	//use longitude, latitude data to convert into x,y coordinates to create path on globe
	
	}
	}
	}
	
	else if(foodchain[nodenamec].migrating==true) {
	for(var c=0;c<foodchain[nodenamec].locations.length;c++) {
	var locationid=(foodchain[nodenamec].locations[c].replace(/ /g,''))+""+(nodenamec.replace(/ /g,''));
	svg3.append("circle")
	.attr("class","maplocs")
	.attr("id",locationid)
	.attr("r", 4)
    .attr("fill", function() {
	return color3(foodchain[nodenamec].locations[c]);
	}) 
    .attr("stroke","#2F4F4F")
	.attr("transform", function() {
    return "translate(" + projection([foodchain[nodenamec].longitude[c], foodchain[nodenamec].latitude[c]]) + ")";
     });
	
	}
	svg3.append("path")
	.attr("class","mappaths")
	.attr("id","olala")
	 .attr("d", function() {
	 var firstlat=foodchain[nodenamec].latitude[0]+7;
	 var firstlong=foodchain[nodenamec].longitude[0]-15;
	 var firstpoint=projection([firstlong,firstlat]);
	 var totalpath="M"+firstpoint;
	 for(var d=1;d<foodchain[nodenamec].locations.length;d++) {
	 totalpath=totalpath+" L"+projection([foodchain[nodenamec].longitude[d]-15,foodchain[nodenamec].latitude[d]+7]);
	 }
	 return totalpath;
	 })
	 .style("fill","none")
	 .attr("stroke","#F2E394")
	 .attr("stroke-width","1")
	 .attr("opacity",0);
	
	
	//migration animation goes here -----------------------------------------------------------------------------------------<
	
	
	svg3.append("image")
	.attr("xlink:href","Imgtypes/bird.png")
	.attr("width",50)
	.attr("height",50)
	.attr("class","mapimages")
	.attr("id",function() {
	return "anims";
	});
	var animsid="#anims";
	svg3.select(animsid)
	.append("animateMotion")
	.attr("id",function(){
	return "animationin";
	})
	.attr("dur","10s")
	.attr("repeatCount","indefinite");
	
	var animationinid="#animationin";
	
	svg3.select(animationinid)
	.append("mpath")
	.attr("id", function() {
	return "tri";
	})
	.attr("xlink:href","#olala");
	
	}
	
	// stack Description here ---------------------------------------------------------------------------------------------<
	
	
	d3.selectAll(".consspan").remove();
	d3.selectAll(".prodspan").remove();
	d3.selectAll(".titledesc").remove();
	d3.selectAll(".imgdesc").remove();
	d3.selectAll(".otherdesc").remove();
	d3.selectAll(".mtitledesc").remove();
	d3.selectAll(".mdescdesc").remove();
	d3.selectAll(".mapdesc").remove();
	
	d3.select(".stackdesc").append("div")
	.attr("class","titledesc");
	
	d3.select(".titledesc")
	.append("span")
	.attr("class","consspan")
	.append("text")
	.text(nodenamec);
	if(foodchain[nodenamec].eats) {
	for(var e=0;e<foodchain[nodenamec].eats.length;e++) {
	
	d3.select(".titledesc")
	.append("span")
	.attr("class","prodspan")
	.append("text")
	.text(foodchain[nodenamec].eats[e]);
	
		
	}
	}
	var imgpath="Images/"+nodenamec+".jpg";
	d3.select(".stackdesc")
	.append("div")
	.attr("class","imgdesc")
	.append("img")
	.attr("src",imgpath);
	
	d3.select(".stackdesc")
	.append("div")
	.attr("class","otherdesc");
	
	d3.select(".otherdesc")
	.append("div")
	.attr("class","descdesc")
	.append("text")
	.text(foodchain[nodenamec].description);
	
	d3.select(".otherdesc")
	.append("div")
	.attr("class","linkdesc");
		
	d3.select(".linkdesc")
	.html("<a href='https://en.wikipedia.org/wiki/"+nodenamec+"' class='anchor' target='_blank'>More Info</a>")
	
	
	//map description here ---------------------------------------------------------------------------------------------<
	d3.select("body").append("svg")
	.attr("class","mapdesc");

	var xcor=10;
	var ycor=10;
	for(var m=0;m<foodchain[nodenamec].locations.length;m++) {
	var countryname=foodchain[nodenamec].locations[m];
	
	d3.select(".mapdesc")
	.append("rect")
	.attr("width","10")
	.attr("x",xcor)
	.attr("y",ycor)
	.attr("height","10")
	.attr("stroke","#000")
	.attr("stroke-width","1")
	.attr("fill",function() {
	return color3(foodchain[nodenamec].locations[m]);
	});
	
	d3.select(".mapdesc")
	.append("text")
	.text(countryname)
	.attr("x",xcor+20)
	.attr("y",ycor+10);
	
	if(m>6)
	xcor=150;
	
	ycor=ycor+30;
	}
	
	

	})
	.on("dblclick", function() {
	/*alert("doubleclick");*/
	})
	.on("mouseover", function() {
	var imgsrc="Images/"+nodenamec+".jpg";
	div2.transition()    
            .duration(200)    
            .style("opacity", 1.0);    
      div2.html(nodenamec+"<br>")
            .style("left", (d3.event.pageX) + "px")   
            .style("top", (d3.event.pageY - 28) + "px");
			if(ifchildc==false) {
			div2.append("img")
			.attr("class","picture")
			.attr("src",imgsrc)
			.attr("width",120)
			.attr("height",150);
		
			d3.select(".tooltip2")
			.style("width","122px")
			.style("height","168px");
		}
	})
	.on("mouseout", function() {
	div2.transition()    
                .duration(500)    
               .style("opacity", 0);
	d3.select(".tooltip2")
			.style("width","100px")
			.style("height","20px");
	});
	
 }
 
 var lvltotal=[0,0,0,0,0];
  d3.json("data.json", function(json) {
  
  
  var leafwidth=width2/json.leafs;
  console.log(json);
  var lvl=[0,0,0,0,0];
for(var j=0;j<json.children.length;j++){
lvl[0]=lvl[0]+1;
lvltotal[0]=lvltotal[0]+json.children[j].leafs;
for(var k=0;k<json.children[j].children.length;k++){
lvl[1]=lvl[1]+1;
lvltotal[1]=lvltotal[1]+json.children[j].children[k].leafs;
for(var l=0;l<json.children[j].children[k].children.length;l++){
lvl[2]=lvl[2]+1;
lvltotal[2]=lvltotal[2]+json.children[j].children[k].children[l].leafs;
for(var m=0;m<json.children[j].children[k].children[l].children.length;m++){
lvl[3]=lvl[3]+1;
lvltotal[3]=lvltotal[3]+json.children[j].children[k].children[l].children[m].leafs;
if(json.children[j].children[k].children[l].children[m].children){
for(var n=0;n<json.children[j].children[k].children[l].children[m].children.length;n++){
lvl[4]=lvl[4]+1;
lvltotal[4]=lvltotal[4]+json.children[j].children[k].children[l].children[m].children[n].leafs;
}
}
}
}
}
}

  console.log(lvl[0]+"-"+lvl[1]+"-"+lvl[2]+"-"+lvl[3]+"-"+lvl[4]);
  
  if(json.children) {
  json.xpos=0;
  json.ypos=0;
  json.width=width2;
  var lvl0position=0;
  for(var j=0;j<lvl[0];j++){
  childarr[json.children[j].name]=new Array();
  var lvl0width=Number(json.children[j].leafs/lvltotal[j]*width2);
  var lvl0level=0;
  json.children[j].ypos=stackheight*(lvl0level+1);
  if(j!=0)
  var lvl0position=Number(lvl0position+((Number(json.children[j-1].leafs)/lvltotal[j-1])*width2));
  var ifchild=json.children[j].children ? true : false;
  json.children[j].xpos=lvl0position;
  json.children[j].width=lvl0width;
  var nodename=json.children[j].name;
  createrect(lvl0width,lvl0level,lvl0position,ifchild,nodename);
  
	if(json.children[j].children) {
	var sum=0;
    for(var k=0;k<json.children[j].children.length;k++) {
	sum=sum+Number(json.children[j].children[k].leafs);
	}
	
	var lvl1position=Number(json.children[j].xpos);
	for(var k=0;k<json.children[j].children.length;k++){
	childarr[json.children[j].children[k].name]=new Array();
	var lvl1width=Number((Number(json.children[j].children[k].leafs)/sum)*Number(json.children[j].width));
	json.children[j].children[k].width=lvl1width;
	var lvl1level=1;
	json.children[j].children[k].ypos=stackheight*(lvl1level+1);
	if(k!=0)
	var lvl1position=Number((Number(json.children[j].children[k-1].width)+Number(json.children[j].children[k-1].xpos)));
	json.children[j].children[k].xpos=lvl1position;
	var ifchild=json.children[j].children[k].children ? true : false;
	var nodename=json.children[j].children[k].name;
	createrect(lvl1width,lvl1level,lvl1position,ifchild,nodename);
	
	if(json.children[j].children[k].children) {
	var sum1=0;
    for(var l=0;l<json.children[j].children[k].children.length;l++) {
	sum1=sum1+Number(json.children[j].children[k].children[l].leafs);
	}
	
	var lvl2position=Number(json.children[j].children[k].xpos);
	for(var l=0;l<json.children[j].children[k].children.length;l++){
	childarr[json.children[j].children[k].children[l].name]=new Array();
	var lvl2width=Number((Number(json.children[j].children[k].children[l].leafs)/sum1)*Number(json.children[j].children[k].width));
	json.children[j].children[k].children[l].width=lvl2width;
	var lvl2level=2;
	json.children[j].children[k].children[l].ypos=stackheight*(lvl2level+1);
	if(l!=0)
	var lvl2position=Number(Number(json.children[j].children[k].children[l-1].width)+Number(json.children[j].children[k].children[l-1].xpos));
	json.children[j].children[k].children[l].xpos=lvl2position;
	var ifchild=json.children[j].children[k].children[l].children ? true : false;
	var nodename=json.children[j].children[k].children[l].name;
	createrect(lvl2width,lvl2level,lvl2position,ifchild,nodename);
	
	if(json.children[j].children[k].children[l].children) {
	var sum2=0;
    for(var m=0;m<json.children[j].children[k].children[l].children.length;m++) {
	sum2=sum2+Number(json.children[j].children[k].children[l].children[m].leafs);
	}
	
	var lvl3position=Number(json.children[j].children[k].children[l].xpos);
	for(var m=0;m<json.children[j].children[k].children[l].children.length;m++){
	if(json.children[j].children[k].children[l].children[m].children) {
	childarr[json.children[j].children[k].children[l].children[m].name]=new Array();
	}
	if(json.children[j].children[k].children[l].children[m].leafs)
	var lvl3width=Number(Number(json.children[j].children[k].children[l].children[m].leafs)/sum2*Number(json.children[j].children[k].children[l].width));
	else
	var lvl3width=leafwidth;
	json.children[j].children[k].children[l].children[m].width=lvl3width;
	var lvl3level=3;
	var lvl3ypos=stackheight*(lvl3level+1);
	json.children[j].children[k].children[l].children[m].ypos=stackheight*(lvl3level+1);
	if(m!=0)
	var lvl3position=Number(Number(json.children[j].children[k].children[l].children[m-1].width)+Number(json.children[j].children[k].children[l].children[m-1].xpos));
	json.children[j].children[k].children[l].children[m].xpos=lvl3position;
	var ifchild=json.children[j].children[k].children[l].children[m].children ? true : false;
	var nodename=json.children[j].children[k].children[l].children[m].name;
	
	if(!(json.children[j].children[k].children[l].children[m].children)) {
	if(json.children[j].children[k].children[l].children[m].eats)
	var eatsarr=json.children[j].children[k].children[l].children[m].eats;
	else
	var eatsarr=[];
	}
	createrect(lvl3width,lvl3level,lvl3position,ifchild,nodename);
	
	
	if(!(json.children[j].children[k].children[l].children[m].children)) {
	//push json.children[j].children[k].children[l].children[m].name
	
	childarr[json.children[j].name].push(json.children[j].children[k].children[l].children[m].name);
	childarr[json.children[j].children[k].name].push(json.children[j].children[k].children[l].children[m].name);
	childarr[json.children[j].children[k].children[l].name].push(json.children[j].children[k].children[l].children[m].name);
	var locations=[];
	var latitude=[];
	var longitude=[];
	if(json.children[j].children[k].children[l].children[m].locations) {
	for(var a=0;a<json.children[j].children[k].children[l].children[m].locations.length;a++) {
	locations[a]=json.children[j].children[k].children[l].children[m].locations[a];
	latitude[a]=json.children[j].children[k].children[l].children[m].latitude[a];
	longitude[a]=json.children[j].children[k].children[l].children[m].longitude[a];
	}
	}
	var migrating=false;
	if(json.children[j].children[k].children[l].children[m].migrating) {
	if(json.children[j].children[k].children[l].children[m].migrating==true)
	migrating=true;
	}
	
	var description="olala";
	if(json.children[j].children[k].children[l].children[m].description) {
	var description=json.children[j].children[k].children[l].children[m].description;
	}
	
	foodchain[nodename]={
	"description":description,
	"migrating":migrating,
	"locations":locations,
	"latitude":latitude,
	"longitude":longitude,
	"xpos":lvl3position,
	"ypos":lvl3ypos,
	"level":lvl3level,
	"width":lvl3width,
	"eats":eatsarr,
	"status":0,
	"parentpos":[
	{"xpos":json.children[j].children[k].children[l].xpos, "ypos":json.children[j].children[k].children[l].ypos},
	{"xpos":json.children[j].children[k].xpos,"ypos":json.children[j].children[k].ypos},
	{"xpos":json.children[j].xpos,"ypos":json.children[j].ypos}
	]
	};
	}
	
	
    if(json.children[j].children[k].children[l].children[m].children){
	var lvl4position=Number(json.children[j].children[k].children[l].children[m].xpos);
	for(var p=0;p<json.children[j].children[k].children[l].children[m].children.length;p++) {
	var lvl4width=leafwidth;
	json.children[j].children[k].children[l].children[m].children[p].width=lvl4width;
	var lvl4level=4;
	var lvl4ypos=stackheight*(lvl4level+1);
	json.children[j].children[k].children[l].children[m].children[p].ypos=stackheight*(lvl4level+1);
	if(p!=0)
	var lvl4position=Number(Number(json.children[j].children[k].children[l].children[m].children[p-1].xpos)+Number(json.children[j].children[k].children[l].children[m].children[p-1].width));
	json.children[j].children[k].children[l].children[m].children[p].xpos=lvl4position;
	var ifchild=json.children[j].children[k].children[l].children[m].children[p].children ? true : false;
	var nodename=json.children[j].children[k].children[l].children[m].children[p].name;
	
	if(json.children[j].children[k].children[l].children[m].children[p].eats) {
	var eatsarr=json.children[j].children[k].children[l].children[m].children[p].eats;
	}
	else {
	var eatsarr=[];
	}
	createrect(lvl4width,lvl4level,lvl4position,ifchild,nodename);
	
	childarr[json.children[j].name].push(json.children[j].children[k].children[l].children[m].children[p].name);
	childarr[json.children[j].children[k].name].push(json.children[j].children[k].children[l].children[m].children[p].name);
	childarr[json.children[j].children[k].children[l].name].push(json.children[j].children[k].children[l].children[m].children[p].name);
	childarr[json.children[j].children[k].children[l].children[m].name].push(json.children[j].children[k].children[l].children[m].children[p].name);
	
	
	
	var locations=[];
	var latitude=[];
	var longitude=[];
	if(json.children[j].children[k].children[l].children[m].children[p].locations) {
	for(var a=0;a<json.children[j].children[k].children[l].children[m].children[p].locations.length;a++) {
	locations[a]=json.children[j].children[k].children[l].children[m].children[p].locations[a];
	latitude[a]=json.children[j].children[k].children[l].children[m].children[p].latitude[a];
	longitude[a]=json.children[j].children[k].children[l].children[m].children[p].longitude[a];
	}
	}
	
	var migrating=false;
	if(json.children[j].children[k].children[l].children[m].children[p].migrating) {
	if(json.children[j].children[k].children[l].children[m].children[p].migrating==true)
	migrating=true;
	}
	
	var description="olala";
	if(json.children[j].children[k].children[l].children[m].children[p].description) {
	var description=json.children[j].children[k].children[l].children[m].children[p].description;
	}
	
	foodchain[nodename]={
	"description":description,
	"migrating":migrating,
	"locations":locations,
	"latitude":latitude,
	"longitude":longitude,
	"xpos":lvl4position,
	"ypos":lvl4ypos,
	"level":lvl4level,
	"width":lvl4width,
	"eats":eatsarr,
	"status":0,
	"parentpos":[
	{"xpos":json.children[j].children[k].children[l].children[m].xpos, "ypos":json.children[j].children[k].children[l].children[m].ypos},
	{"xpos":json.children[j].children[k].children[l].xpos, "ypos":json.children[j].children[k].children[l].ypos},
	{"xpos":json.children[j].children[k].xpos,"ypos":json.children[j].children[k].ypos},
	{"xpos":json.children[j].xpos,"ypos":json.children[j].ypos}
	]
	};
	}
	}
	
	
	}
	}
	}
	}
	}
	}
  }
  }
  console.log(foodchain);
});


  </script>
  <div class="stackdesc"></div>
  
  <div class=".speciesdis">
  
  
  <div id="pieChart"></div>
    <div id="barChart"></div>  
    <script type="text/javascript">

var 	formatAsPercentage = d3.format("%"),
		formatAsPercentage1Dec = d3.format(".1%"),
		formatAsInteger = d3.format(","),
		fsec = d3.time.format("%S s"),
		fmin = d3.time.format("%M m"),
		fhou = d3.time.format("%H h"),
		fwee = d3.time.format("%a"),
		fdat = d3.time.format("%d d"),
		fmon = d3.time.format("%b")
		;

/*
############# PIE CHART ###################
-------------------------------------------
*/



function dsPieChart(){

	var dataset = [
			{category: "Plants", measure: 0.33},
	      {category: "Reptiles", measure: 0.14},
		  {category: "Fishes", measure: 0.28},
	      {category: "Birds", measure: 0.12},
	      {category: "Amphibians", measure: 0.07},
	      {category: "Mammals", measure: 0.06}
	      ]
	      ;

	var 	width = 400,
		   height = 400,
		   outerRadius = Math.min(width, height) / 2,
		   innerRadius = outerRadius * .999,   
		   // for animation
		   innerRadiusFinal = outerRadius * .5,
		   innerRadiusFinal3 = outerRadius* .45,
		   color = d3.scale.category20()    //builtin range of colors
		   ;
	    
	var vis = d3.select("#pieChart")
	     .append("svg:svg")              //create the SVG element inside the <body>
	     .data([dataset])                   //associate our data with the document
	         .attr("width", width)           //set the width and height of our visualization (these will be attributes of the <svg> tag
	         .attr("height", height)
	     		.append("svg:g")                //make a group to hold our pie chart
	         .attr("transform", "translate(" + outerRadius + "," + outerRadius + ")")    //move the center of the pie chart from 0, 0 to radius, radius
				;
				
   var arc = d3.svg.arc()              //this will create <path> elements for us using arc data
        	.outerRadius(outerRadius).innerRadius(innerRadius);
   
   // for animation
   var arcFinal = d3.svg.arc().innerRadius(innerRadiusFinal).outerRadius(outerRadius);
	var arcFinal3 = d3.svg.arc().innerRadius(innerRadiusFinal3).outerRadius(outerRadius);

   var pie = d3.layout.pie()           //this will create arc data for us given a list of values
        .value(function(d) { return d.measure; });    //we must tell it out to access the value of each element in our data array

   var arcs = vis.selectAll("g.slice")     //this selects all <g> elements with class slice (there aren't any yet)
        .data(pie)                          //associate the generated pie data (an array of arcs, each having startAngle, endAngle and value properties) 
        .enter()                            //this will create <g> elements for every "extra" data element that should be associated with a selection. The result is creating a <g> for every object in the data array
            .append("svg:g")                //create a group to hold each slice (we will have a <path> and a <text> element associated with each slice)
               .attr("class", "slice")    //allow us to style things in the slices (like text)
               .on("mouseover", mouseover)
    				.on("mouseout", mouseout)
    				.on("click", up)
    				;
    				
        arcs.append("svg:path")
               .attr("fill", function(d, i) { return color(i); } ) //set the color for each slice to be chosen from the color function defined above
               .attr("d", arc)     //this creates the actual SVG path using the associated data (pie) with the arc drawing function
					.append("svg:title") //mouseover title showing the figures
				   .text(function(d) { return d.data.category + ": " + formatAsPercentage(d.data.measure); });			

        d3.selectAll("g.slice").selectAll("path").transition()
			    .duration(750)
			    .delay(10)
			    .attr("d", arcFinal )
			    ;
	
	 
	  arcs.filter(function(d) { return d.endAngle - d.startAngle > .2; })
	  		.append("svg:text")
	      .attr("dy", ".35em")
	      .attr("text-anchor", "middle")
	      .attr("transform", function(d) { return "translate(" + arcFinal.centroid(d) + ")rotate(" + angle(d) + ")"; })
	      //.text(function(d) { return formatAsPercentage(d.value); })
	      .text(function(d) { return d.data.category; })
	      ;
	   
	   // Computes the label angle of an arc, converting from radians to degrees.
		function angle(d) {
		    var a = (d.startAngle + d.endAngle) * 90 / Math.PI - 90;
		    return a > 90 ? a - 180 : a;
		}
		    
		
		// Pie chart title			
		vis.append("svg:text")
	     	.attr("dy", ".35em")
	      .attr("text-anchor", "middle")
	      .text("Species Distribution")
	      .attr("class","title")
	      ;		    


		
	function mouseover() {
	  d3.select(this).select("path").transition()
	      .duration(750)
	        		.attr("d", arcFinal3)
	        		;
	}
	
	function mouseout() {
	  d3.select(this).select("path").transition()
	      .duration(750)
	        		.attr("d", arcFinal)
	        		;
	}
	
	function up(d, i) {
	
				updateBarChart(d.data.category, color(i));
				updateLineChart(d.data.category, color(i));
			 
	}
}

dsPieChart();

// Define the div for the tooltip
var div = d3.select("body").append("div")	
    .attr("class", "tooltip")				
    .style("opacity", 0);

var datasetBarChart = [
{ group: "All", category: "Least Concern", measure: 30334.0000 }, 
{ group: "All", category: "Threatened", measure: 14856.0000 }, 
{ group: "All", category: "Extinct", measure: 164.0000 }, 
{ group: "All", category: "Data Deficient", measure: 4782.0000 }, 
{ group: "All", category: "Not Evaluated", measure: 39338.0000 }, 
{ group: "Plants", category: "Least Concern", measure: 842.0000 }, 
{ group: "Plants", category: "Threatened", measure: 1023.0000 }, 
{ group: "Plants", category: "Extinct", measure: 12.0000 }, 
{ group: "Plants", category: "Data Deficient", measure: 75.0000 }, 
{ group: "Plants", category: "Not Evaluated", measure: 29259.0000 }, 
{ group: "Reptiles", category: "Least Concern", measure: 7966.0000 }, 
{ group: "Reptiles", category: "Threatened", measure: 2286.0000 }, 
{ group: "Reptiles", category: "Extinct", measure: 11.0000 }, 
{ group: "Reptiles", category: "Data Deficient", measure: 80.0000 }, 
{ group: "Reptiles", category: "Not Evaluated", measure: 1741.0000 }, 
{ group: "Fishes", category: "Least Concern", measure: 8970.0000 }, 
{ group: "Fishes", category: "Threatened", measure: 6552.0000 }, 
{ group: "Fishes", category: "Extinct", measure: 89.0000 }, 
{ group: "Fishes", category: "Data Deficient", measure: 2869.0000 }, 
{ group: "Fishes", category: "Not Evaluated", measure: 6976.0000 }, 
{ group: "Birds", category: "Least Concern", measure: 7749.0000 }, 
{ group: "Birds", category: "Threatened", measure: 2068.0000 }, 
{ group: "Birds", category: "Extinct", measure: 4.0000 }, 
{ group: "Birds", category: "Data Deficient", measure: 61.0000 }, 
{ group: "Birds", category: "Not Evaluated", measure: 111.0000 }, 
{ group: "Amphibians", category: "Least Concern", measure: 1958.0000 }, 
{ group: "Amphibians", category: "Threatened", measure: 1682.0000 }, 
{ group: "Amphibians", category: "Extinct", measure: 35.0000 }, 
{ group: "Amphibians", category: "Data Deficient", measure: 1095.0000 }, 
{ group: "Amphibians", category: "Not Evaluated", measure: 943.0000 }, 
{ group: "Mammals", category: "Least Concern", measure: 2849.0000 }, 
{ group: "Mammals", category: "Threatened", measure: 1246.0000 }, 
{ group: "Mammals", category: "Extinct", measure: 13.0000 }, 
{ group: "Mammals", category: "Data Deficient", measure: 602.0000 }, 
{ group: "Mammals", category: "Not Evaluated", measure: 310.0000 }
]
;

// set initial group value
var group = "All";

function datasetBarChosen(group) {
	var ds = [];
	for (x in datasetBarChart) {
		 if(datasetBarChart[x].group==group){
		 	ds.push(datasetBarChart[x]);
		 } 
		}
	return ds;
}


function dsBarChartBasics() {

		var margin = {top: 30, right: 5, bottom: 20, left: 50},
		width = 500 - margin.left - margin.right,
	   height = 250 - margin.top - margin.bottom,
		colorBar = d3.scale.category20(),
		barPadding = 1
		;
		
		return {
			margin : margin, 
			width : width, 
			height : height, 
			colorBar : colorBar, 
			barPadding : barPadding
		}			
		;
}

function dsBarChart() {

	var firstDatasetBarChart = datasetBarChosen(group);         	
	
	var basics = dsBarChartBasics();
	
	var margin = basics.margin,
		width = basics.width,
	   height = basics.height,
		colorBar = basics.colorBar,
		barPadding = basics.barPadding
		;
					
	var 	xScale = d3.scale.linear()
						.domain([0, firstDatasetBarChart.length])
						.range([0, width])
						;
						
	  
	var yScale = d3.scale.linear()
		   .domain([0, d3.max(firstDatasetBarChart, function(d) { return d.measure; })])
		   .range([height, 0])
		   ;
	
	//Create SVG element
	
	var svg = d3.select("#barChart")
			.append("svg")
		    .attr("width", width + margin.left + margin.right)
		    .attr("height", height + margin.top + margin.bottom)
		    .attr("id","barChartPlot")
		    ;
	
	var plot = svg
		    .append("g")
		    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
		    ;
	            
	plot.selectAll("rect")
		   .data(firstDatasetBarChart)
		   .enter()
		   .append("rect")
			.attr("x", function(d, i) {
			    return xScale(i);
			})
		   .attr("width", width / firstDatasetBarChart.length - barPadding)   
			.attr("y", function(d) {
			    return yScale(d.measure);
			})  
			.attr("height", function(d) {
			    return height-yScale(d.measure);
			})
			.attr("fill", "lightgrey")
			;
	
		
	// Add y labels to plot	
	
	plot.selectAll("text")
	.data(firstDatasetBarChart)
	.enter()
	.append("text")
	.text(function(d) {
			return formatAsInteger(d3.round(d.measure));
	})
	.on("mouseover", function(d) {		
            div.transition()		
                .duration(200)		
                .style("opacity", .9);		
             div.html(formatAsInteger(d3.round(d.measure)))	
                .style("left", (d3.event.pageX) + "px")		
                .style("top", (d3.event.pageY - 28) + "px");	
            })					
    .on("mouseout", function(d) {		
            div.transition()		
                .duration(500)		
                .style("opacity", 0);	
        })
	.attr("text-anchor", "middle")
	// Set x position to the left edge of each bar plus half the bar width
	.attr("x", function(d, i) {
			return (i * (width / firstDatasetBarChart.length)) + ((width / firstDatasetBarChart.length - barPadding) / 2);
	})
	.attr("y", function(d) {
			return yScale(d.measure) + 14;
	})
	.attr("class", "yAxis")
		
	
	var xLabels = svg
		    .append("g")
		    .attr("transform", "translate(" + margin.left + "," + (margin.top + height)  + ")")
		    ;
	
	xLabels.selectAll("text.xAxis")
		  .data(firstDatasetBarChart)
		  .enter()
		  .append("text")
		  .text(function(d) { return d.category;})
		  .attr("text-anchor", "middle")
			// Set x position to the left edge of each bar plus half the bar width
						   .attr("x", function(d, i) {
						   		return (i * (width / firstDatasetBarChart.length)) + ((width / firstDatasetBarChart.length - barPadding) / 2);
						   })
		  .attr("y", 15)
		  .attr("class", "xAxis")
		  //.attr("style", "font-size: 12; font-family: Helvetica, sans-serif")
		  ;			
	 
	// Title
	
	svg.append("text")
		.attr("x", (width + margin.left + margin.right)/2)
		.attr("y", 15)
		.attr("class","title")				
		.attr("text-anchor", "middle")
		.text("Conservation Status Breakdown")
		;
		    

}

dsBarChart();

 /* ** UPDATE CHART ** */
 
/* updates bar chart on request */

function updateBarChart(group, colorChosen) {
	
		var currentDatasetBarChart = datasetBarChosen(group);
		
		var basics = dsBarChartBasics();
	
		var margin = basics.margin,
			width = basics.width,
		   height = basics.height,
			colorBar = basics.colorBar,
			barPadding = basics.barPadding
			;
		
		var 	xScale = d3.scale.linear()
			.domain([0, currentDatasetBarChart.length])
			.range([0, width])
			;
		
			
		var yScale = d3.scale.linear()
	      .domain([0, d3.max(currentDatasetBarChart, function(d) { return d.measure; })])
	      .range([height,0])
	      ;
	      
	   var svg = d3.select("#barChart svg");
	      
	   var plot = d3.select("#barChartPlot")
	   	.datum(currentDatasetBarChart)
		   ;
	
	  		/* Note that here we only have to select the elements - no more appending! */
	  	plot.selectAll("rect")
	      .data(currentDatasetBarChart)
	      .transition()
			.duration(750)
			.attr("x", function(d, i) {
			    return xScale(i);
			})
		   .attr("width", width / currentDatasetBarChart.length - barPadding)   
			.attr("y", function(d) {
			    return yScale(d.measure);
			})  
			.attr("height", function(d) {
			    return height-yScale(d.measure);
			})
			.attr("fill", colorChosen)
			;
		
		plot.selectAll("text.yAxis") // target the text element(s) which has a yAxis class defined
			.data(currentDatasetBarChart)
			.transition()
			.duration(750)
		   .attr("text-anchor", "middle")
		   .attr("x", function(d, i) {
		   		return (i * (width / currentDatasetBarChart.length)) + ((width / currentDatasetBarChart.length - barPadding) / 2);
		   })
		   .attr("y", function(d) {
		   		return yScale(d.measure) + 14;
		   })
		   .text(function(d) {
				return formatAsInteger(d3.round(d.measure));
		   })
		   .attr("class", "yAxis")					 
		;		

		svg.selectAll("text.title") // target the text element(s) which has a title class defined
			.attr("x", (width + margin.left + margin.right)/2)
			.attr("y", 15)
			.attr("class","title")				
			.attr("text-anchor", "middle")
			.text(group + " Conservation Status Breakdown")
		;
}

// set initial category value
var group = "All";

function datasetLineChartChosen(group) {
	var ds = [];
	for (x in datasetLineChart) {
		 if(datasetLineChart[x].group==group){
		 	ds.push(datasetLineChart[x]);
		 } 
		}
	return ds;
}

function dsLineChartBasics() {

	var margin = {top: 20, right: 10, bottom: 0, left: 50},
	    width = 500 - margin.left - margin.right,
	    height = 150 - margin.top - margin.bottom
	    ;
		
		return {
			margin : margin, 
			width : width, 
			height : height
		}			
		;
}


function dsLineChart() {

	var firstDatasetLineChart = datasetLineChartChosen(group);    
	
	var basics = dsLineChartBasics();
	
	var margin = basics.margin,
		width = basics.width,
	   height = basics.height
		;

	var xScale = d3.scale.linear()
	    .domain([0, firstDatasetLineChart.length-1])
	    .range([0, width])
	    ;

	var yScale = d3.scale.linear()
	    .domain([0, d3.max(firstDatasetLineChart, function(d) { return d.measure; })])
	    .range([height, 0])
	    ;
	
	var line = d3.svg.line()
	    //.x(function(d) { return xScale(d.category); })
	    .x(function(d, i) { return xScale(i); })
	    .y(function(d) { return yScale(d.measure); })
	    ;
	
	var svg = d3.select("#lineChart").append("svg")
	    .datum(firstDatasetLineChart)
	    .attr("width", width + margin.left + margin.right)
	    .attr("height", height + margin.top + margin.bottom)
	    // create group and move it so that margins are respected (space for axis and title)
	    
	var plot = svg
	    .append("g")
	    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
	    .attr("id", "lineChartPlot")
	    ;

		/* descriptive titles as part of plot -- start */
	var dsLength=firstDatasetLineChart.length;

	plot.append("text")
		.text(firstDatasetLineChart[dsLength-1].measure)
		.attr("id","lineChartTitle2")
		.attr("x",width/2)
		.attr("y",height/2)	
		;
	/* descriptive titles -- end */
	    
	plot.append("path")
	    .attr("class", "line")
	    .attr("d", line)	
	    // add color
		.attr("stroke", "lightgrey")
	    ;
	  
	plot.selectAll(".dot")
	    .data(firstDatasetLineChart)
	  	 .enter().append("circle")
	    .attr("class", "dot")
	    //.attr("stroke", function (d) { return d.measure==datasetMeasureMin ? "red" : (d.measure==datasetMeasureMax ? "green" : "steelblue") } )
	    .attr("fill", function (d) { return d.measure==d3.min(firstDatasetLineChart, function(d) { return d.measure; }) ? "red" : (d.measure==d3.max(firstDatasetLineChart, function(d) { return d.measure; }) ? "green" : "white") } )
	    //.attr("stroke-width", function (d) { return d.measure==datasetMeasureMin || d.measure==datasetMeasureMax ? "3px" : "1.5px"} )
	    .attr("cx", line.x())
	    .attr("cy", line.y())
	    .attr("r", 3.5)
	    .attr("stroke", "lightgrey")
	    .append("title")
	    .text(function(d) { return d.category + ": " + formatAsInteger(d.measure); })
	    ;

	svg.append("text")
		.text("Line Graph")
		.attr("id","lineChartTitle1")	
		.attr("x",margin.left + ((width + margin.right)/2))
		.attr("y", 10)
		;

}

dsLineChart();


 /* ** UPDATE CHART ** */
 
/* updates bar chart on request */
function updateLineChart(group, colorChosen) {

	var currentDatasetLineChart = datasetLineChartChosen(group);   

	var basics = dsLineChartBasics();
	
	var margin = basics.margin,
		width = basics.width,
	   height = basics.height
		;

	var xScale = d3.scale.linear()
	    .domain([0, currentDatasetLineChart.length-1])
	    .range([0, width])
	    ;

	var yScale = d3.scale.linear()
	    .domain([0, d3.max(currentDatasetLineChart, function(d) { return d.measure; })])
	    .range([height, 0])
	    ;
	
	var line = d3.svg.line()
    .x(function(d, i) { return xScale(i); })
    .y(function(d) { return yScale(d.measure); })
    ;

   var plot = d3.select("#lineChartPlot")
   	.datum(currentDatasetLineChart)
	   ;
	   
	/* descriptive titles as part of plot -- start */
	var dsLength=currentDatasetLineChart.length;
	
	plot.select("text")
		.text(currentDatasetLineChart[dsLength-1].measure)
		;
	/* descriptive titles -- end */
	   
	plot
	.select("path")
		.transition()
		.duration(750)			    
	   .attr("class", "line")
	   .attr("d", line)	
	   // add color
		.attr("stroke", colorChosen)
	   ;
	   
	var path = plot
		.selectAll(".dot")
	   .data(currentDatasetLineChart)
	   .transition()
		.duration(750)
	   .attr("class", "dot")
	   .attr("fill", function (d) { return d.measure==d3.min(currentDatasetLineChart, function(d) { return d.measure; }) ? "red" : (d.measure==d3.max(currentDatasetLineChart, function(d) { return d.measure; }) ? "green" : "white") } )
	   .attr("cx", line.x())
	   .attr("cy", line.y())
	   .attr("r", 3.5)
	   // add color
		.attr("stroke", colorChosen)
	   ;
	   
	   path
	   .selectAll("title")
	   .text(function(d) { return d.category + ": " + formatAsInteger(d.measure); })	 
	   ;  

}

    </script>
  
  
  
  </div>
  
  </body>
</html>
